<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <base th:href="${#request.getContextPath()}+'/'">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>商品管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/ace-rtl.min.css">
    <link rel="stylesheet" href="css/jquery-ui-1.10.3.custom.min.css">
    <link rel="stylesheet" href="css/jquery.gritter.css">
    <link type="text/css" rel="stylesheet" href="css/public.css">
    <script type="text/javascript" src="js/ace-extra.min.js"></script>
    <script type="text/javascript" src="js/jquery-3.1.1.js"></script>
    <!-- 系统共用js文件 -->
    <link rel="stylesheet" type="text/css" href="css/ymPrompt.css">
    <script type="text/javascript" src="js/ymPrompt.js"></script>
    <script type="text/javascript" src="js/public.js"></script>
    <script type="text/javascript" src="js/publics.js"></script>
    <script type="text/javascript" src="js/table.js"></script>
    <script type="text/javascript" src="js/vdata.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/typeahead-bs2.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui-1.10.3.custom.min.js"></script>
    <script type="text/javascript" src="js/jquery.ui.touch-punch.min.js"></script>
    <script type="text/javascript" src="js/bootbox.min.js"></script>
    <script type="text/javascript" src="js/jquery.gritter.min.js"></script>
    <!-- ace scripts -->
    <script type="text/javascript" src="js/ace-elements.min.js"></script>
    <script type="text/javascript" src="js/ace.min.js"></script>
    <script type="text/javascript" src="js/WdatePicker.js"></script>
    <script type="text/javascript" src="js/lhgdialog.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/WdatePicker.css">
</head>

<body style="">
<div class="" style="left: 0px; top: 0px; visibility: hidden; position: absolute;">
    <table class="ui_border">
        <tbody>
        <tr>
            <td class="ui_lt"></td>
            <td class="ui_t"></td>
            <td class="ui_rt"></td>
        </tr>
        <tr>
            <td class="ui_l"></td>
            <td class="ui_c">
                <div class="ui_inner">
                    <table class="ui_dialog">
                        <tbody>
                        <tr>
                            <td colspan="2">
                                <div class="ui_title_bar">
                                    <div class="ui_title" unselectable="on" style="cursor: move;"></div>
                                    <div class="ui_title_buttons"><a class="ui_min" href="javascript:void(0);"
                                                                     title="最小化" style="display: inline-block;"><b
                                            class="ui_min_b"></b></a><a class="ui_max" href="javascript:void(0);"
                                                                        title="最大化" style="display: inline-block;"><b
                                            class="ui_max_b"></b></a><a class="ui_res" href="javascript:void(0);"
                                                                        title="还原"><b class="ui_res_b"></b><b
                                            class="ui_res_t"></b></a><a class="ui_close" href="javascript:void(0);"
                                                                        title="关闭(esc键)" style="display: inline-block;">×</a>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td class="ui_icon" style="display: none;"></td>
                            <td class="ui_main" style="width: auto; height: auto;">
                                <div class="ui_content" style="padding: 10px;"></div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <div class="ui_buttons" style="display: none;"></div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </td>
            <td class="ui_r"></td>
        </tr>
        <tr>
            <td class="ui_lb"></td>
            <td class="ui_b"></td>
            <td class="ui_rb" style="cursor: se-resize;"></td>
        </tr>
        </tbody>
    </table>
</div>

<div class="main-container" id="main-container">
    <script type="text/javascript">
        try {
            ace.settings.check('main-container', 'fixed')
        } catch (e) {
        }
    </script>
    <div class="main-content">
        <div class="breadcrumbs" id="breadcrumbs">
            <script type="text/javascript">
                try {
                    ace.settings.check('breadcrumbs', 'fixed')
                } catch (e) {
                }
            </script>
            <ul class="breadcrumb">
                <li>
                    <i class="icon-home home-icon"></i>
                    <a href="http://localhost:8081/cust/index">首页</a>
                </li>
                <li>
                    <a href="http://localhost:8081/cust/goods/list">商品管理</a>
                </li>
                <li>
                    <a href="http://localhost:8081/cust/goods/add">增加商品</a>
                </li>

            </ul><!-- .breadcrumb -->

        </div>

        <div class="page-content">
            <div class="page-header">
                <h1>
                    温馨提示：
                    <small>
                        商品添加/修改成功后，需要管理员审核通过后才能发布到会员推广商品列表
                    </small>
                </h1>
            </div>
                <div class="widget-main">
                    <input type="hidden" id="sku_str" name="sku_str" value="">
                    <input type="hidden" id="ctype" name="ctype" value="">
                    <input type="hidden" id="sku_title" name="sku_title" value="">
                    <input type="hidden" id="sku_cost" name="sku_cost" value="">
                    <input type="hidden" id="sku_pmoney" name="sku_pmoney" value="">
                    <input type="hidden" id="service_money" name="service_money" value="">
                    <input type="hidden" id="sku_price" name="sku_price" value="">
                    <input type="hidden" id="good_id" name="good_id" value="">
                    <input type="hidden" id="copy_id" name="copy_id" value="">
                    <input type="hidden" id="spc_id" name="spc_id" value="">
                    <input type="hidden" id="zon_id" name="zon_id" value="">
                    <input type="hidden" id="optype" name="optype" value="">
                    <input type="hidden" id="iswxpay" name="iswxpay" value="">
                    <input type="hidden" id="customer_id" name="customer_id" value="">

                     <table class="table table-bordered table-striped">
                        <tbody>
                        <tr>
                            <td align="right">
                                <span class="red">*</span><strong>商户ID：</strong>
                            </td>
                            <td>
                                <input type="text" id="user_name" name="user_name" value="">
                            </td>
                        </tr>
                        <tr>
                            <td align="right">
                                <span class="red">*</span><strong>商品名称：</strong>
                            </td>
                            <td>
                                <input type="text" id="good_name" name="good_name" value="">
                            </td>
                        </tr>
                        <tr>
                            <td align="right">
                                <span class="red">*</span>
                                <strong>商品类型：</strong>
                            </td>
                            <td>
                                <select name="type_id" id="type_id" style="width:252px;font-size:14px"
                                        class="selectBox">
                                    <option value="">请选择...</option>
                                    <option value="01">保健品</option>
                                    <option value="02">饰品</option>
                                    <option value="03">护肤品</option>
                                    <option value="04">床上用品</option>
                                    <option value="05">生活用品</option>
                                    <option value="06">减肥产品</option>
                                    <option value="07">113</option>
                                    <option value="08">23</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td align="right"><span class="red">*</span><strong>排序编号：</strong></td>
                            <td>
                                <input type="text" id="order_no" name="order_no" onkeyup="checkVal2(this);" value="">
                            </td>
                        </tr>
                        <tr>
                            <td align="right"><span class="red">*</span><strong>购买作弊值：</strong></td>
                            <td>
                                <input type="text" id="sell_num" name="sell_num" onkeyup="checkVal2(this);" value="">
                            </td>
                        </tr>
                        <!------------------------------------------------------>
                        <tr>
                            <td align="right"><strong>图片1预览：</strong></td>
                            <td>
                                <div id="sm_div1">
                                    <img src="img/no_pic.png" id="sm_yl1"
                                         style="width:240px;height:150px;border:1px solid #ddd;">
                                </div>
                            </td>
                        </tr>
                        <!--第一张图片上传-->
                            <tr>
                                <td align="right"><span class="red">*</span><strong>上传图片：</strong></td>
                                <td>
                                    <form id="form1" enctype="multipart/form-data">
                                    <input type="file" name="file" id="smfile1&quot;"
                                           style="width:540px;height:22px;cursor:hand" class="fileinput"
                                           onchange="upload('form1','sm_yl1')">
                                    </form>
                                </td>
                            </tr>
                        <!------------------------------------------------------>
                        <tr>
                            <td align="right"><strong>图片2预览：</strong></td>
                            <td>
                                <div id="sm_div2">
                                    <img src="img/no_pic.png" id="sm_yl2"
                                         style="width:240px;height:150px;border:1px solid #ddd;">
                                </div>
                            </td>
                        </tr>
                        <!--第二张图片上传-->
                            <tr>
                                <td align="right"><span class="red">*</span><strong>上传图片2：</strong></td>
                                <td>
                                    <form id="form2" enctype="multipart/form-data">
                                    <input type="file" name="file" id="smfile2&quot;"
                                           style="width:540px;height:22px;cursor:hand" class="fileinput"
                                           onchange="upload('form2','sm_yl2')">
                                    </form>
                                </td>
                            </tr>
                        <!------------------------------------------------------>
                        <tr>
                            <td align="right"><strong>图片3预览：</strong></td>
                            <td>
                                <div id="sm_div3">
                                    <img src="img/no_pic.png" id="sm_yl3"
                                         style="width:240px;height:150px;border:1px solid #ddd;">
                                </div>
                            </td>
                        </tr>
                        <!--第三张图片上传-->
                            <tr>
                                <td align="right"><span class="red">*</span><strong>上传图片3：</strong></td>
                                <td>
                                    <form id="form3" enctype="multipart/form-data">
                                    <input type="file" name="file" id="smfile3&quot;"
                                           style="width:540px;height:22px;cursor:hand" class="fileinput"
                                           onchange="upload('form3','sm_yl3')">
                                    </form>
                                </td>
                            </tr>
                        <tr>
                            <td align="right"><span class="red">*</span><strong>推广说明：</strong></td>
                            <td>
                                <textarea id="promote_desc" name="promote_desc"
                                          style="width:540px; height: 160px;"></textarea>
                            </td>
                        </tr>
                        <tr>
                            <td align="right"><span class="red">*</span><strong>商品套餐：</strong></td>
                            <td>
                                <table id="tcbg" class="table table-bordered table-striped">
                                    <tbody>
                                    <tr>
                                        <th align="left" style="background-color:#F9F9F9">(<font color="red">*</font>)描述
                                        </th>
                                        <th align="left" style="background-color:#F9F9F9">(<font color="red">*</font>)成本
                                        </th>
                                        <th align="left" style="background-color:#F9F9F9">(<font color="red">*</font>)价格
                                        </th>
                                        <th align="left" style="background-color:#F9F9F9">(<font color="red">*</font>)分成
                                        </th>
                                        <th align="left" style="background-color:#F9F9F9">(<font color="red">*</font>)客服提成
                                        </th>
                                    </tr>
                                    </tbody>
                                </table>
                                <div style="margin-top:10px">
                                    <button class="btn btn-sm btn-primary"
                                            onclick="insertRowsc($VD(&#39;tcbg&#39;),23);return false;">
                                        <i class="icon-save"></i>
                                        增加
                                    </button>
                                    <!--<button class="btn btn-sm btn-danger" onclick="del_row($VD('tcbg'));return false;">
                                        <i class="icon-trash"></i>
                                        删除
                                  </button>-->
                                    (<font color="red">提示信息：</font>上述所有输入项均为必填项目，请务必填入相应值后保存！)
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td align="right"><span class="red">*</span><strong>商品标签：</strong></td>
                            <td>
                                <label>
                                    <input type="checkbox" class="ace" id="1" name="tags" value="0">
                                    <span class="lbl">
								             <span class="btn btn-danger dropdown-toggle">热销爆款</span>
								          </span>
                                </label>
                                <label>
                                    <input type="checkbox" class="ace" id="2" name="tags" value="1">
                                    <span class="lbl">
								             <span class="btn btn-warning dropdown-toggle">女粉推荐</span>
								          </span>
                                </label>
                                <label>
                                    <input type="checkbox" class="ace" id="3" name="tags" value="2">
                                    <span class="lbl">
								             <span class="btn btn-primary dropdown-toggle">男粉推荐</span>
										  </span>
                                </label>
                                <label>
                                    <input type="checkbox" class="ace" id="4" name="tags" value="3">
                                    <span class="lbl">
								             <span class="btn btn-success dropdown-toggle">人气新品</span>
								          </span>
                                </label>
                                <label>
                                    <input type="checkbox" class="ace" id="5" name="tags" value="4">
                                    <span class="lbl">
								             <span class="btn btn-info dropdown-toggle">男女通用</span>
								          </span>
                                </label>
                            </td>
                        </tr>
                        <tr>
                            <td align="right"><span class="red">*</span><strong>微信文案：</strong></td>
                            <td>
                                <input type="checkbox" class="ace" id="copy_wa" name="gcopy" value="1887427">
                                <span class="lbl">&nbsp;<a
                                        href="http://localhost:8081/cust/goods/add#">文案</a></span><br>
                            </td>
                        </tr>
                        <tr>
                            <td align="right"><strong>站内文案：</strong></td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td align="right"><strong>空间文案：</strong></td>
                            <td>
                                <input type="checkbox" class="ace" id="copy_kj" name="zcopy_id" value="39201701">
                                <span class="lbl">&nbsp;<a
                                        href="http://localhost:8081/cust/goods/add#">12</a></span><br>
                            </td>
                        </tr>

                        <tr>
                            <td align="right"><strong>跳转说明：</strong></td>
                            <td>
                                <textarea id="copy_desc" name="copy_desc" style="width:540px; height:80px;"></textarea>
                            </td>
                        </tr>

                        <tr>
                            <td align="right"><strong>跳转地址：</strong></td>
                            <td>
                                <input type="text" id="forward_link" name="forward_link" style="width:540px;" value="">
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" align="center">
							             <span id="submit" onclick="submit();" class="btn btn-lxg btn-primary">
							               <i class="icon-save bigger-120"></i>
							                保存
							             </span>
                                <span id="back" onclick="goToPage(&#39;/cust/goods/list&#39;);"
                                      class="btn btn-lxg btn-undo">
							             <i class="icon-undo bigger-120"></i>
							                返回 </span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
        </div>
    </div>
    <a href="http://localhost:8081/cust/goods/add#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
        <i class="icon-double-angle-up icon-only bigger-110"></i>
    </a>
</div>

<script type="text/javascript">
    if ("ontouchend" in document) document.write("<script src='js/jquery.mobile.custom.min.js'>" + "<" + "script>");
</script>


<div id="ldg_dragmask"
     style="display: none; position: fixed; left: 0px; top: 0px; width: 100%; height: 100%; cursor: move; opacity: 0; background: rgb(255, 255, 255); pointer-events: none;"></div>
<div>
    <div id="maskLevel" style="position:absolute;top:0;left:0;display:none;text-align:center;z-index:10000;"></div>
    <div id="ym-window" style="position:absolute;z-index:10001;display:none">
        <div class="ym-tl" id="ym-tl">
            <div class="ym-tr">
                <div class="ym-tc" style="cursor:move;">
                    <div class="ym-header-text"></div>
                    <div class="ym-header-tools"></div>
                </div>
            </div>
        </div>
        <div class="ym-ml" id="ym-ml">
            <div class="ym-mr">
                <div class="ym-mc">
                    <div class="ym-body"></div>
                </div>
            </div>
        </div>
        <div class="ym-ml" id="ym-btnl">
            <div class="ym-mr">
                <div class="ym-btn"></div>
            </div>
        </div>
        <div class="ym-bl" id="ym-bl">
            <div class="ym-br">
                <div class="ym-bc"></div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script type="text/javascript">
    jQuery(function ($) {
        $('table th input:checkbox').on('click', function () {
            var that = this;
            $(this).closest('table').find('tr > td:first-child input:checkbox')
                .each(function () {
                    if (!this.disabled) {
                        this.checked = that.checked;
                        $(this).closest('tr').toggleClass('selected');
                    }
                });
        });
    })
</script>

<script type="text/javascript">
    (function (config) {
        config['extendDrag'] = true; // 注意，此配置参数只能在这里使用全局配置，在调用窗口的传参数使用无效
        config['lock'] = true;
        config['fixed'] = true;
        config['okVal'] = '确定';
        config['cancelVal'] = '取消';
    })($.dialog.setting);

    // 如果只设置一个或少量全局配置也可这样：
    $.dialog.setting.extendDrag = true;

</script>
<!--2001-->
<script type="text/javascript">
    //ids表示表单的id，通过一个方法完成三个表单的上传功能
    function upload(ids, imgId) {
        var form = $("#" + ids)[0];
        var formData = new FormData(form);
        $.ajax({
            url: "upload",
            type: "post",
            data: formData,
            contentType: false,//不指定任何的数据类型，二进制传输
            processData: false,//不在传输过程中格式化数据，二进制传输
            success: function (data) {
                if (data.code == 0) {
                    $("#" + imgId).attr("src", data.obj);
                    // $("#imgPath").val(data.obj);
                } else {
                    alert("上传失败");
                }
            }
        });
    }

    function submit() {
        var customerId=$("#customerId").val();
        var goodsName = $("#good_name").val();
        var typeId = $("#type_id").val();
        var orderNo = $("#order_no").val();
        var sellNum = $("#sell_num").val();
        var userId = $("#user_id").val();
        var promoteDesc = $("#promote_desc").val();
        var goodsImages1 = $("#sm_yl1").attr("src");
        var goodsImages2 = $("#sm_yl2").attr("src");
        var goodsImages3 = $("#sm_yl3").attr("src");

        var tags=[];
        $("input[name='dg1_RowCheck']").each(function () {
            if($(this).is(":checked")){
                tags=$(this).val();
            }
        });

        if (goodsName == "") {
            alert("商品名称不能为空");
            return;
        }
        if (typeId=="") {
            alert("请选择商品类型");
            return;
        }
        if (goodsImages1 == "no_pic.png" || goodsImages1 == "") {
            alert("请上传商品图片1");
            return;
        }
        if (goodsImages2 == "no_pic.png" || goodsImages2 == "") {
            alert("请上传商品图片2");
            return;
        }
        if (goodsImages3 == "no_pic.png" || goodsImages3 == "") {
            alert("请上传商品图片3");
            return;
        }
        if (orderNo == "null" || orderNo == "") {
            alert("对不起！排序编号不能为空！");
            return;
        }
        if (promoteDesc == "null" || sellNum == "") {
            alert("对不起！推广说明不能为空！");
            return;
        }

        var skuArray=new Array();
        //获取套餐
        var trTags = $("tr[id='23']");
        for (var i = 0; i < trTags.length; i++) {
            var skuJson={};
            var tdTags = $(trTags[i]).children("td");
            var inputTags = $(tdTags).children("input");
            for (var j = 0; j < inputTags.length; j++) {
                var key = $(inputTags[j]).attr("name");
                var value = $(inputTags[j]).val();
                skuJson[key]=value;

                skuJson["skuId"]=Math.round(Math.random()*(99999999-10000000)+10000000);
            }
            skuArray.push(skuJson);
        }

        var resultOv = {"wxbGoods":{"customerId":customerId,"goodsName":goodsName,"typeId":typeId,"goodsPic1":goodsImages1,
                "goodsPic2":goodsImages2,"goodsPic3":goodsImages3,"orderNo":orderNo,
                "sellNum":sellNum,"promoteDesc":promoteDesc},"sku2List":skuArray,"tags":tags,"userId":userId};

        $.ajax({
            url:"save",
            method:"post",
            data:JSON.stringify(resultOv),
            dataType:"json",
            contentType:"application/json",
            success:function(data){
                if(data.code==0){
                    alert(data.obj)
                    $("#content").load("gInfo");
                }else{
                    alert(data.obj)
                }

            }
        });
    }
</script>